/*! xcssmatrix - v0.0.5 - 2012-10-01
* https://github.com/jfsiii/XCSSMatrix
* Copyright (c) 2012 John Schulz; Licensed MIT */
function XCSSMatrix(e){this.m11=this.m22=this.m33=this.m44=1,this.m12=this.m13=this.m14=this.m21=this.m23=this.m24=this.m31=this.m32=this.m34=this.m41=this.m42=this.m43=0,typeof e=="string"&&this.setMatrixValue(e)}function indextoKey2d(e){return String.fromCharCode(e+97)}function indextoKey3d(e){return"m"+(Math.floor(e/4)+1)+(e%4+1)}function objectValues(e){return e.value}function cssFunctionToJsFunction(e){return jsFunctions[e]}function parsedToDegrees(e){return e.units==="rad"?(e.value=utils.angles.rad2deg(e.value),e.units="deg"):e.units==="grad"&&(e.value=utils.angles.grad2deg(e.value),e.units="deg"),e}function transformMatrix(e,t){t.value=t.value.map(parsedToDegrees);var n=cssFunctionToJsFunction(t.key),r=n(e,t);return r||e}function toMatrixString(e){var t=utils.transp.stringToStatements(e);if(t.length===1&&/^matrix/.test(e))return e;var n=utils.funcs.onlyFirstArg(utils.transp.statementToObject),r=t.map(n),i=new XCSSMatrix,s=r.reduce(transformMatrix,i),o=s.toString();return o}var utils={angles:require("./angleUtils"),matrix:require("./matrixUtils"),transp:require("./cssTransformStringUtils"),funcs:{onlyFirstArg:function(e,t){return t=t||this,function(n){return e.call(t,n)}}}};XCSSMatrix.displayName="XCSSMatrix";var points2d=["a","b","c","d","e","f"],points3d=["m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44"];[["m11","a"],["m12","b"],["m21","c"],["m22","d"],["m41","e"],["m42","f"]].forEach(function(e){var t=e[0],n=e[1];Object.defineProperty(XCSSMatrix.prototype,n,{set:function(e){this[t]=e},get:function(){return this[t]},enumerable:!0,configurable:!0})}),XCSSMatrix.prototype.multiply=function(e){if(!e)return null;var t=e,n=this,r=new XCSSMatrix;return r.m11=t.m11*n.m11+t.m12*n.m21+t.m13*n.m31+t.m14*n.m41,r.m12=t.m11*n.m12+t.m12*n.m22+t.m13*n.m32+t.m14*n.m42,r.m13=t.m11*n.m13+t.m12*n.m23+t.m13*n.m33+t.m14*n.m43,r.m14=t.m11*n.m14+t.m12*n.m24+t.m13*n.m34+t.m14*n.m44,r.m21=t.m21*n.m11+t.m22*n.m21+t.m23*n.m31+t.m24*n.m41,r.m22=t.m21*n.m12+t.m22*n.m22+t.m23*n.m32+t.m24*n.m42,r.m23=t.m21*n.m13+t.m22*n.m23+t.m23*n.m33+t.m24*n.m43,r.m24=t.m21*n.m14+t.m22*n.m24+t.m23*n.m34+t.m24*n.m44,r.m31=t.m31*n.m11+t.m32*n.m21+t.m33*n.m31+t.m34*n.m41,r.m32=t.m31*n.m12+t.m32*n.m22+t.m33*n.m32+t.m34*n.m42,r.m33=t.m31*n.m13+t.m32*n.m23+t.m33*n.m33+t.m34*n.m43,r.m34=t.m31*n.m14+t.m32*n.m24+t.m33*n.m34+t.m34*n.m44,r.m41=t.m41*n.m11+t.m42*n.m21+t.m43*n.m31+t.m44*n.m41,r.m42=t.m41*n.m12+t.m42*n.m22+t.m43*n.m32+t.m44*n.m42,r.m43=t.m41*n.m13+t.m42*n.m23+t.m43*n.m33+t.m44*n.m43,r.m44=t.m41*n.m14+t.m42*n.m24+t.m43*n.m34+t.m44*n.m44,r},XCSSMatrix.prototype.inverse=function(){var e;if(utils.matrix.isIdentityOrTranslation(this)){e=new XCSSMatrix;if(this.m41!==0||this.m42!==0||this.m43!==0)e.m41=-this.m41,e.m42=-this.m42,e.m43=-this.m43;return e}var t=utils.matrix.adjoint(this),n=utils.matrix.determinant4x4(this);if(Math.abs(n)<1e-8)return null;for(var r=1;r<5;r++)for(var i=1;i<5;i++)t["m"+r+i]/=n;return t},XCSSMatrix.prototype.rotate=function(e,t,n){if(typeof e!="number"||isNaN(e))e=0;(typeof t!="number"||isNaN(t))&&(typeof n!="number"||isNaN(n))&&(n=e,e=0,t=0);if(typeof t!="number"||isNaN(t))t=0;if(typeof n!="number"||isNaN(n))n=0;e=utils.angles.deg2rad(e),t=utils.angles.deg2rad(t),n=utils.angles.deg2rad(n);var r=new XCSSMatrix,i=new XCSSMatrix,s=new XCSSMatrix,o,u,a;n/=2,o=Math.sin(n),u=Math.cos(n),a=o*o,s.m11=s.m22=1-2*a,s.m12=s.m21=2*o*u,s.m21*=-1,t/=2,o=Math.sin(t),u=Math.cos(t),a=o*o,i.m11=i.m33=1-2*a,i.m13=i.m31=2*o*u,i.m13*=-1,e/=2,o=Math.sin(e),u=Math.cos(e),a=o*o,r.m22=r.m33=1-2*a,r.m23=r.m32=2*o*u,r.m32*=-1;var f=new XCSSMatrix,l=this.toString()===idenity.toString(),c=l?s.multiply(i).multiply(r):this.multiply(r).multiply(i).multiply(s);return c},XCSSMatrix.prototype.rotateAxisAngle=function(e,t,n,r){if(typeof e!="number"||isNaN(e))e=0;if(typeof t!="number"||isNaN(t))t=0;if(typeof n!="number"||isNaN(n))n=0;if(typeof r!="number"||isNaN(r))r=0;e===0&&t===0&&n===0&&(n=1);var i=new XCSSMatrix,s=Math.sqrt(e*e+t*t+n*n),o,u,a,f,l,c,h;return r=(utils.angles.deg2rad(r)||0)/2,o=Math.cos(r),u=Math.sin(r),a=u*u,s===0?(e=0,t=0,n=1):s!==1&&(e/=s,t/=s,n/=s),e===1&&t===0&&n===0?(i.m22=i.m33=1-2*a,i.m23=i.m32=2*o*u,i.m32*=-1):e===0&&t===1&&n===0?(i.m11=i.m33=1-2*a,i.m13=i.m31=2*o*u,i.m13*=-1):e===0&&t===0&&n===1?(i.m11=i.m22=1-2*a,i.m12=i.m21=2*o*u,i.m21*=-1):(f=u*o,l=e*e,c=t*t,h=n*n,i.m11=1-2*(c+h)*a,i.m12=2*(e*t*a+n*f),i.m13=2*(e*n*a-t*f),i.m21=2*(t*e*a-n*f),i.m22=1-2*(h+l)*a,i.m23=2*(t*n*a+e*f),i.m31=2*(n*e*a+t*f),i.m32=2*(n*t*a-e*f),i.m33=1-2*(l+c)*a),this.multiply(i)},XCSSMatrix.prototype.scale=function(e,t,n){var r=new XCSSMatrix;if(typeof e!="number"||isNaN(e))e=1;if(typeof t!="number"||isNaN(t))t=e;if(typeof n!="number"||isNaN(n))n=1;return r.m11=e,r.m22=t,r.m33=n,this.multiply(r)},XCSSMatrix.prototype.skewX=function(e){var t=utils.angles.deg2rad(e),n=new XCSSMatrix;return n.c=Math.tan(t),this.multiply(n)},XCSSMatrix.prototype.skewY=function(e){var t=utils.angles.deg2rad(e),n=new XCSSMatrix;return n.b=Math.tan(t),this.multiply(n)},XCSSMatrix.prototype.translate=function(e,t,n){var r=new XCSSMatrix;if(typeof e!="number"||isNaN(e))e=0;if(typeof t!="number"||isNaN(t))t=0;if(typeof n!="number"||isNaN(n))n=0;return r.m41=e,r.m42=t,r.m43=n,this.multiply(r)},XCSSMatrix.prototype.setMatrixValue=function(e){var t=toMatrixString(e.trim()),n=utils.transp.statementToObject(t);if(!n)return;var r=n.key===utils.transp.matrixFn3d,i=r?indextoKey3d:indextoKey2d,s=n.value,o=s.length;if(r&&o!==16||!r&&o!==6)return;s.forEach(function(e,t){var n=i(t);this[n]=e.value},this)},XCSSMatrix.prototype.toString=function(){var e,t;return utils.matrix.isAffine(this)?(t=utils.transp.matrixFn2d,e=points2d):(t=utils.transp.matrixFn3d,e=points3d),t+"("+e.map(function(e){return this[e].toFixed(6)},this).join(", ")+")"};var jsFunctions={matrix:function(e,t){var n=new XCSSMatrix(t.unparsed);return e.multiply(n)},matrix3d:function(e,t){var n=new XCSSMatrix(t.unparsed);return e.multiply(n)},perspective:function(e,t){var n=new XCSSMatrix;return n.m34-=1/t.value[0].value,e.multiply(n)},rotate:function(e,t){return e.rotate.apply(e,t.value.map(objectValues))},rotate3d:function(e,t){return e.rotateAxisAngle.apply(e,t.value.map(objectValues))},rotateX:function(e,t){return e.rotate.apply(e,[t.value[0].value,0,0])},rotateY:function(e,t){return e.rotate.apply(e,[0,t.value[0].value,0])},rotateZ:function(e,t){return e.rotate.apply(e,[0,0,t.value[0].value])},scale:function(e,t){return e.scale.apply(e,t.value.map(objectValues))},scale3d:function(e,t){return e.scale.apply(e,t.value.map(objectValues))},scaleX:function(e,t){return e.scale.apply(e,t.value.map(objectValues))},scaleY:function(e,t){return e.scale.apply(e,[0,t.value[0].value,0])},scaleZ:function(e,t){return e.scale.apply(e,[0,0,t.value[0].value])},skew:function(e,t){var n=new XCSSMatrix("skewX("+t.value[0].unparsed+")"),r=new XCSSMatrix("skewY("+t.value[1].unparsed+")"),i="matrix(1.00000, "+r.b+", "+n.c+", 1.000000, 0.000000, 0.000000)",s=new XCSSMatrix(i);return e.multiply(s)},skewX:function(e,t){return e.skewX.apply(e,[t.value[0].value])},skewY:function(e,t){return e.skewY.apply(e,[t.value[0].value])},translate:function(e,t){return e.translate.apply(e,t.value.map(objectValues))},translate3d:function(e,t){return e.translate.apply(e,t.value.map(objectValues))},translateX:function(e,t){return e.translate.apply(e,[t.value[0].value,0,0])},translateY:function(e,t){return e.translate.apply(e,[0,t.value[0].value,0])},translateZ:function(e,t){return e.translate.apply(e,[0,0,t.value[0].value])}};module.exports=XCSSMatrix;